<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Updating the default Python 3.6 to 3.7 on Gentoo Linux">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python3: Out with the old, in with the new | /dev/ncdulo</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#6c757d">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://ncdulo.github.io/posts/2020/04/python3-out-with-the-old-in-with-the-new/">
<link rel="icon" href="../../../../favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="robots" contents="index,follow">
<meta name="revisit-after" contents="7 days">
<meta name="copyright" content="ncdulo 2020">
<meta name="author" content="ncdulo">
<link rel="prev" href="../quick-easy-management-of-nikola-website/" title="Quick &amp; easy management of Nikola websites" type="text/html">
<meta property="og:site_name" content="/dev/ncdulo">
<meta property="og:title" content="Python3: Out with the old, in with the new">
<meta property="og:url" content="https://ncdulo.github.io/posts/2020/04/python3-out-with-the-old-in-with-the-new/">
<meta property="og:description" content="Updating the default Python 3.6 to 3.7 on Gentoo Linux">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-04-23T04:53:01-04:00">
<meta property="article:tag" content="gentoo">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="python">
<meta property="article:tag" content="python2">
<meta property="article:tag" content="python3">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="https://ncdulo.github.io/">

            <span id="blog-title">/dev/ncdulo</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Categories</a>
                </li>
<li class="nav-item">
<a href="../../../../tags/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="https://github.com/ncdulo" class="nav-link">GitHub</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.rst" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Python3: Out with the old, in with the&nbsp;new</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">&nbsp;ncdulo
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-04-23T04:53:01-04:00" itemprop="datePublished" title="2020-04-23 04:53">2020-04-23 04:53</time><span class="updated"> (updated
                    <time class="updated dt-updated" datetime="2020-04-23T21:43:41-04:00" itemprop="dateUpdated" title="2020-04-23 21:43">2020-04-23 21:43</time>)</span>
            </a>
            </p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Oh, happy day! I truly do enjoy Python version bumps. With <cite>Python 2</cite> at EOL,
and <a class="reference external" href="https://www.gentoo.org/">Gentoo Linux</a> making big moves over the past couple of months to bump the
Python3 default target to <cite>Python 3.7</cite>, it has been a very exciting time for
me to be working so much with Python. Though a bit confusing at times, the
care and attention put in by the <a class="reference external" href="https://wiki.gentoo.org/wiki/Project:Python">Gentoo Python Team</a> has made this an easier
transition to go&nbsp;through.</p>
<!-- TEASER_END -->
<div class="section" id="diff-gentoo">
<h2><code class="docutils literal">diff gentoo</code></h2>
<p>As part of my usual morning routine, one of the first things I check on the
computer is a <code class="docutils literal">diff</code> of the changes introduced to the Gentoo package
repositories since my last sync <a class="footnote-reference brackets" href="#id2" id="id1">1</a>. Honestly, it&#8217;s a great way to start the
day for me. I highly reccommend the <a class="reference external" href="https://github.com/vaeth/eix/">eix</a> utility for <em>much</em> quicker package
searching than <cite>Portage</cite> allows for, if nothing&nbsp;else.</p>
<p>Anyway, the point of that mention &#8212; this morning I noticed <cite>Python 3.8</cite> had
been bumped to stable on <code class="docutils literal">amd64</code>. Finally! I couldn&#8217;t quite determine if this
was intended to be another slotted version, or if it would coincide with other
updates to the <cite>Gentoo Python</cite> ecosystem. Checking a bit deeper into this now,
I noticed a news item, <a class="reference external" href="https://www.gentoo.org/support/news-items/2020-04-22-python3-7.html">Python 3.7 to become the default target</a>.</p>
<p>Wow! This is getting exciting! Reading through that was initially a bit
confusing, but it <em>really</em> made my day. Being that it&#8217;s a weekday, I did have to
put that on hold and head to work. It did give me an opportunity to read over
the news item a bit more, and consider how to handle this update. With Python
being <em>just</em> a bit integral to Gentoo, I have decided to not rush into this,
and let <cite>Portage</cite> do what it wants to do. For me, this means simply accepting
the update without modifying either of the <code class="docutils literal">PYTHON_{TARGETS,SINGLE_TARGET}</code>
values. At this moment, if you are using the default targets, no further action
is required at this time. Simply <code class="docutils literal">emerge <span class="pre">-uDNatv</span> @world</code> as usual, and carry
on. For me, the only Python related change there was pulling in version 3.8 as
it is now marked stable. At least on <code class="docutils literal">amd64</code> that&nbsp;is.</p>
</div>
<div class="section" id="what-if-i-don-t-want-to-wait">
<h2>What if I don&#8217;t want to&nbsp;wait?</h2>
<p>Two weeks is quite a long time away, I know. Thankfully, you can go ahead with
the migration, if you like. How cleanly, or painfully this may happen will
somewhat depend on the packages installed to your system which utilize <cite>Python
3.6</cite> as their default target. If you utilize any services, or daemons that target
that version, you may wish to apply the update in parts, described below.
Alternatively, if those programs can be stopped during the update, it may help
ensure no errors occur. The news post linked <a class="reference external" href="https://www.gentoo.org/support/news-items/2020-04-22-python3-7.html">here</a> does mention that already
loaded <span class="amp">&amp;</span> running programs should not encounter errors during this update.
However, if they are restarted or load additional modules during this process,
there may be errors. If you <em>do</em> keep them running during the update, you will
need to restart them after it has completed so they can load up again using the
new <cite>Python 3.7</cite> target they will have been rebuilt for. My personal
recommendation is to apply the update in parts to minimize any risk of breakage
to currently running&nbsp;programs.</p>
<div class="sidebar">
<p class="sidebar-title">Why&nbsp;reiterate?</p>
<p>The <cite>Gentoo News</cite> post lists out all of the relevant steps, though I at first
had a slight bit of difficulty making them all out. Thus I have compiled the
steps here, with my own thoughts in hope it may be of some help to another&nbsp;person.</p>
</div>
</div>
<div class="section" id="how-do-we-do-this">
<h2>How do we do&nbsp;this?</h2>
<p>The news item lists out all of the relevant steps, and should provide ample
information to proceed without any major issues. The processes laid out below
come from that news item, with my own thoughts. Three different scenarios are
described&nbsp;below</p>
<div class="section" id="update-all-at-once">
<h3>Update all at&nbsp;once</h3>
<p>So long as you have not overriden either <code class="docutils literal">PYTHON_{TARGETS,SINGLE_TARGET}</code> on
your system, the update should happen &#8220;When It&#8217;s Ready™&#8221;. This is expected to be
on, or after May 05, 2020 as per the <cite>Gentoo News</cite> item. Simply stay on top
of your regular system updates and it will happen on it&#8217;s own. Once it <em>does</em>
happen, you will want to clean up any stray packages with commands such&nbsp;as:</p>
<p class="float-left alert alert-danger">The <code class="docutils literal">depclean</code> command has the the potential to remove important packages
from your system. <strong>Always</strong> check the list of packages to remove before
proceeding. If you are uncertain and cannot determine on your own, ask or
skip over it, leaving the package in question&nbsp;installed.</p>
<pre class="code sh"><a name="rest_code_28c6ee2cacbe407dba3e3febcd95452e-1"></a>emerge --depclean --ask
<a name="rest_code_28c6ee2cacbe407dba3e3febcd95452e-2"></a>emerge -1vUD --ask @world
<a name="rest_code_28c6ee2cacbe407dba3e3febcd95452e-3"></a>emerge --depclean --ask
</pre>
<p>Now may be a good time to update your default Python version as&nbsp;well</p>
<pre class="code text"><a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-1"></a>$ eselect python list
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-2"></a>  Available Python interpreters, in order of preference:
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-3"></a>    [1]   python3.6
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-4"></a>    [2]   python3.8 (fallback)
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-5"></a>    [3]   python3.7 (fallback)
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-6"></a>    [4]   python2.7 (fallback)
<a name="rest_code_871abc727b6f42329ce267a2da0a5ffa-7"></a>$ sudo eselect python set 3
</pre>
<p>This series of commands will check <cite>Portage</cite> for any packages which are no
longer required, based on the dependency tree. Then update any packages which
have had changed <code class="docutils literal">USE</code> flags (such as <code class="docutils literal">PYTHON_TARGETS</code>), while taking the
entire dependency tree into account. Finally, a last <code class="docutils literal"><span class="pre">--depclean</span></code> to clear
out any new packages which may no longer be required. This should leave your
system with packages rebuilt to prefer <cite>Python 3.7</cite> whenever possible. Any
packages installed in the future will follow those new defaults as&nbsp;well.</p>
<p>If you would like to improve the stability of the upgrade, use the steps
outlined below&nbsp;instead.</p>
</div>
<div class="section" id="update-in-stages">
<h3>Update in&nbsp;stages</h3>
<p>Temporarily enabling both <cite>Python 3.6</cite> and <cite>Python 3.7</cite> targets may improve
stability of the upgrade. This will cause the dependencies effected by the
update to build with support for both versions wherever possible. The file
edited to enable both Python targets will depend on whether you have a file, or
a directory at <code class="docutils literal">/etc/portage/package.use</code>. If there is a file at that path,
edit it with the following values. If there is a directory at that path, edit a
new file with a name such as <code class="docutils literal"><span class="pre">/etc/portage/package.use/python-targets</span></code>:</p>
<pre class="literal-block">*/* PYTHON_TARGETS: python3_6 python3_7
*/* PYTHON_SINGLE_TARGETS: -* python3_6</pre>
<p>With those two lines added, you should proceed with the first stage of the
update. This will rebuild packages with additional support for <cite>Python 3.7</cite>
where applicable, without removing any <cite>Python 3.6</cite> support&nbsp;yet.</p>
<p class="float-left alert alert-danger">The <code class="docutils literal">depclean</code> command has the the potential to remove important packages
from your system. <strong>Always</strong> check the list of packages to remove before
proceeding. If you are uncertain and cannot determine on your own, ask or
skip over it, leaving the package in question&nbsp;installed.</p>
<pre class="code sh"><a name="rest_code_9b835d25f3014ae7b4659ab68e77b34f-1"></a>emerge --depclean --ask
<a name="rest_code_9b835d25f3014ae7b4659ab68e77b34f-2"></a>emerge -1vUD --ask @world
<a name="rest_code_9b835d25f3014ae7b4659ab68e77b34f-3"></a>emerge --depclean --ask
</pre>
<p>Take the time now to restart any running scripts, daemons, or programs that were
included in that update list. Then either comment out, or delete the two lines
previously added into your <code class="docutils literal">/etc/portage/package.use</code>. You may also want to
update your default Python version at this time through the <code class="docutils literal">eselect</code>
command:</p>
<pre class="literal-block">$ eselect python list
Available Python interpreters, in order of preference:
  [1]   python3.6
  [2]   python3.8 (fallback)
  [3]   python3.7 (fallback)
  [4]   python2.7 (fallback)
$ sudo eselect python set 3</pre>
<p>The final step here is to re-apply the update. This time only <cite>Python 3.7</cite>
support will be built, where applicable. Certain packages may not yet have
been updated to support <cite>Python 3.7</cite>. In these cases, the <a class="reference external" href="https://wiki.gentoo.org/wiki/Project:Python">Gentoo Python Team</a>
is working to push out the updates in time. For those reasons, not every package
will rebuild into <cite>Python 3.7</cite> support right away. As mentioned in the beginning
of this section, <strong>pay attention to the `depclean` command &#8212; it can remove
important system&nbsp;packages!</strong></p>
<pre class="code sh"><a name="rest_code_795cee17081b46d5ac86a4e0c8ef35b8-1"></a>emerge --depclean --ask
<a name="rest_code_795cee17081b46d5ac86a4e0c8ef35b8-2"></a>emerge -1vUD --ask @world
<a name="rest_code_795cee17081b46d5ac86a4e0c8ef35b8-3"></a>emerge --depclean --ask
</pre>
<p>Finally! This all complete, you should be finished up now. Your Gentoo system
should now be using <cite>Python 3.7</cite> as the default version. Packages should have
been rebuilt to prefer <cite>Python 3.7</cite> over other versions, where possible. And
packages built in the future will follow in that&nbsp;preference.</p>
</div>
<div class="section" id="postpone-the-update">
<h3>Postpone the&nbsp;update</h3>
<p>Should you not wish to update the system default Python target for whatever
reason, you can simply block the target. This will prevent <cite>Portage</cite> from
attempting to build that target, using <cite>Python 3.6</cite> instead as it does
currently. The file edited to enable both Python targets will depend on whether
you have a file, or a directory at <code class="docutils literal">/etc/portage/package.use</code>. If there is a
file at that path, edit it with the following values. If there is a directory
at that path, edit a new file with a name such as
<code class="docutils literal"><span class="pre">/etc/portage/package.use/python-targets</span></code>:</p>
<pre class="literal-block">*/* PYTHON_TARGETS: -python3_7 python3_6
*/* PYTHON_SINGLE_TARGETS: -* python3_6</pre>
<p>Should you decide to go ahead with the update in the future, comment out or
remove those two lines. Then proceed as described above, or in the main <cite>Gentoo
News</cite> item <a class="reference external" href="https://www.gentoo.org/support/news-items/2020-04-22-python3-7.html">here</a>.</p>
</div>
</div>
<div class="section" id="in-conclusion">
<h2>In&nbsp;conclusion</h2>
<p>With <cite>Python 3.6</cite> no longer receiving bug fixes, and will be approaching it&#8217;s
own end-of-life just before Christmas of 2021, it is a good time to update.
Enjoy the added features such as nanosecond timers in the <code class="docutils literal">time</code> module, or
Data Classes. Lots more details at official <a class="reference external" href="https://docs.python.org/3/whatsnew/3.7.html">What&#8217;s new in Python 3.7</a> page.
Whether you update all at once, next year, or jump straight to <cite>Python 3.8</cite>,
it is important to keep your system regularly updated. This guide was written
to help facilitate that, and assist any other <cite>Gentoo Linux</cite> users who find
themselves uncertain on how to&nbsp;proceed.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd>
<p>To create, and check the repo <code class="docutils literal">diff</code>, I utilize the <code class="docutils literal">eix</code> utility,
in combination with Portage&#8217;s <code class="docutils literal">postsync</code> hook. The method I used to set this
up is on this <a class="reference external" href="https://wiki.gentoo.org/wiki/Eix#Managing_the_cache">Gentoo Wiki</a> page. This utility has become almost essential to
me as I want to know exactly what changed throughout the&nbsp;repos.</p>
</dd>
</dl>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../tags/gentoo/" rel="tag">gentoo</a></li>
            <li><a class="tag p-category" href="../../../../tags/linux/" rel="tag">linux</a></li>
            <li><a class="tag p-category" href="../../../../tags/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../../../tags/python2/" rel="tag">python2</a></li>
            <li><a class="tag p-category" href="../../../../tags/python3/" rel="tag">python3</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../quick-easy-management-of-nikola-website/" rel="prev" title="Quick &amp; easy management of Nikola websites">Previous&nbsp;post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer" class="text-center">
            Contents © 2020 <a href="https://github.com/ncdulo">ncdulo</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 Intl License" style="border-width:0; margin-bottom:12px;" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script src="../../../../assets/js/moment-with-locales.min.js"></script><!-- fancy dates --><script>
        moment.locale("en");
        fancydates(2, "YYYY-MM-DD HH:mm");
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>